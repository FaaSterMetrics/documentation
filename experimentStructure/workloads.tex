\documentclass[../main.tex]{subfiles}
\begin{document}


\subsection{Workloads}\label{sec:WorkloadsStructure}

The workload is the core of an experiment as it defines how a program is used and tested. 
Thus, we want to make the generated workload reproducible. 
Many aspects play into the resulting workload such as the physical position and network connection of the machine the workload is generated on. 
To minimize those aspects we are automatically provisioning an VPS on AWS which will generate the workload

We generate and define the workload through artillery which allows us to execute user-like workloads 
such as URL path traversal or random path choice on endpoints. 
We utilize this to emulate heterogeneous user behaviour for i.e.\@ the webshop, 
it is also possible to generate high load used i.e.\@ for the IoT application.



The intend to gernerate a workload needs to be defined in the \texttt{"services"} section of the \texttt{experiment.json}, specifying the workload path relative to the \texttt{experiments/functionname/} path. % TODO: link experiment.json figure

We are using standard artillery workload-definitions so the \texttt{official documentation}\footnote{\url{https://artillery.io/docs/}} apply. However there are some requirements that need to be fullfilled, please reference % TODO: link usageGuide/workloads.tex guide
Please see Figure~\ref{fig:exampleWorkloadYML} for an example of a valid FaaSterMetrics workload.yml.

We've made use of their scripting capabilities to inject an unique identifier into every request header to allow keeping track of where every single request went. 

For this we define the \texttt{beforeRequest} and \texttt{afterResponse} callbacks for each request which the \texttt{artillery/logger.js} file provides.
In the case of the iot workloads we also use javascript callbacks to attach an image to certain requests.

\begin{figure}[H]
  \begin{tcolorbox}[titleDetachedStyle, title=\texttt{workload.yml}]
  \begin{minted}{yaml}
config:
  target: ' '
  phases:
    - duration: 10
      arrivalRate: 10
  processor: '{{ $processEnvironment.PROCESSOR_DIR }}/logger.js'
  defaults:
scenarios:
  - flow:
      - post:
          url: '{{ add }}/call'
          json:
            a: 5
            b: 12
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
    name: 'add'
\end{minted}
\end{tcolorbox}
\caption{Example of a minimal, full workload.yml}%
\label{fig:exampleWorkloadYML}
\end{figure}

\end{document}
