\documentclass[../main.tex]{subfiles}
\begin{document}

\section{Setup}\label{sec:setup}
In this chapter, the experiment setup process will be explained.


\subsection{Cloning the Repository}\label{sec:clonesetup}
The first necessary step is to clone the GitHub repository to your local machine with \texttt{git clone git@github.com:FaaSterMetrics/experiments.git}. \\
Next, our prebuild image (\texttt{faastermetrics/experiments}) can be started to setup the providers and conduct the experiments. This has the advantage that only docker (min. version 19.03.8) needs to be installed on the local machine. To start the container run \texttt{./docker/run.sh}. This will start the container and launch a bash shell in which all commands can be executed.
If you prefer to run everything on your local machine have a look at \ref{sec:manualsetup}.

\subsection{Individual Provider Setups}\label{sec:providersetup}

In the next sections are the setup instructions for the different cloud providers. Be aware that self-hosted solutions need to be publicly accessible. Tools like ngrok\footnote{https://ngrok.com/} can be useful for that step.

\subsubsection{Google Cloud Platform}\label{sec:providersetupgcp}

\begin{enumerate}
\item Create a new Google Cloud project with \texttt{<project\_name>}.
\item Go to \textit{IAM > Service account}.
\item Click \textit{Create Service account}.
\item Add the \textit{Project > Owner} permission.
\item Click \textit{Generate Private Key} and download it as json we need the absolute path to the file later.
\item Visit \textit{Cloud Functions} and enable the API.
\item export \texttt{GOOGLE\_APPLICATION\_CREDENTIALS=<path/to/privatekey.json>} environment variable.
\item export \texttt{GOOGLE\_PROJECT=<project\_name>} environment variable.
\item export \texttt{GOOGLE\_REGION=<region e.g. us-east1>} environment variable.
\end{enumerate}

\subsubsection{Amazon Web Services}\label{sec:providersetupaws}
\begin{enumerate}
\item Go to IAM or https://console.aws.amazon.com/iam/home?\#/users.
\item Create a new user.
\item Choose \textit{Programmatic access}.
\item Got to \textit{Attach existing policies directly} and chose \textit{AdministratorAccess}.
\item export \texttt{AWS\_ACCESS\_KEY\_ID=<access\_key>} environment variable.
\item export \texttt{AWS\_SECRET\_ACCESS\_KEY=<secret\_access\_key>} environment variable.
\item export \texttt{AWS\_REGION=<region e.g. us-east-1>} environment variable.
\end{enumerate}

\subsubsection{Microsoft Azure}\label{sec:providersetupazure}
\begin{enumerate}
\item Install the azure-cli.
\item Run \texttt{az login}.
\item Run \texttt{az account list}.
\item Choose your subscription you want to use for the deployment.
\item export \texttt{ARM\_TENANT\_ID=<tenantId from az account list>} environment variable.
\item export \texttt{ARM\_SUBSCRIPTION\_ID=<id from az account list>} environment variable.
\end{enumerate}

\subsubsection{TinyFaaS}\label{sec:providersetuptinyfaas}

\begin{enumerate}
\item If you don't have an tinyFaaS instance follow the instructions here\footnote{https://github.com/FaaSterMetrics/tinyFaaS}.
\item export \texttt{TINYFAAS\_ADDRESS} environment variable. Please note that TINYFAAS\_ADDRESS must be publically visible on the internet in order for other FaaS platforms to talk to it. \textbf{Anyone with access to the tinyFaaS management port (8080) will be able to upload arbitrary functions, it is very advisable to configure your firewall to only let the deploying computer access that port}

\end{enumerate}

\subsubsection{OpenFaaS}\label{sec:providersetupazure}
This will only work with full OpenFaaS not with faasd due to multiple bugs in faasd.
The only supported setup is the one using docker swarm https://docs.openfaas.com/deployment/docker-swarm/
\begin{enumerate}
\item Setup an openfaas instance using https://docs.openfaas.com/deployment/docker-swarm/ and write down the password it generates
\item Install faas-cli https://docs.openfaas.com/cli/install/ and login like the guide above details.
\item Log your local docker into docker hub with docker login (other container registries are not directly supported by this project).
This is needed to deploy functions to openfaas. Please note that by default this will make the functions you deploy to openfaas public on your account.
\item Set your OPENFAAS\_GATEWAY environment variable like detailed below and OPENFAAS\_TOKEN to the password generated during openfaas setup.
\end{enumerate}

\subsubsection{OpenWhisk}\label{sec:providersetupopenwhisk}

\begin{enumerate}
\item Setup OpenWhisk\footnote{https://openwhisk.apache.org/documentation.html\#openwhisk_deployment}
\item Set the OPENWHISK\_EXTERNAL environment variable. For example: https://my.openwhisk-apigateway.faas.
\item Configure credentials with \texttt{wsk property set}
\end{enumerate}

\subsection{Manual Setup}\label{sec:manualsetup}

\end{document}
